# 验证 queue-system.exe 是否成功执行

本文档说明如何验证双击 `queue-system.exe` 后程序是否成功启动。

---

## 🎯 快速验证方法

### 方法一：查看命令行窗口（最简单）

双击 `queue-system.exe` 后，会弹出一个**黑色命令行窗口**。

#### ✅ 成功标志

如果看到以下输出，说明启动成功：

```
已从打包资源中复制初始数据库文件: ... -> ...
数据库初始化成功
定时任务状态: {...}
服务器运行在 http://0.0.0.0:3000
```

**关键信息：**
- ✅ `数据库初始化成功` - 数据库已正确初始化
- ✅ `服务器运行在 http://0.0.0.0:3000` - 服务器已启动并监听端口

#### ❌ 失败标志

如果看到以下错误，说明启动失败：

```
数据库初始化失败: ...
启动定时任务失败: ...
Error: listen EADDRINUSE: address already in use :::3000
```

---

### 方法二：浏览器访问测试（最直观）

#### 步骤 1: 打开浏览器

在浏览器地址栏输入以下任一地址：

```
http://localhost:3000/ticket
http://localhost:3000/display
http://localhost:3000/counter
http://localhost:3000/admin
```

#### 步骤 2: 验证结果

**✅ 成功标志：**
- 页面正常加载，没有错误提示
- 取票页面显示业务类型选择界面
- 显示屏显示排队信息
- 叫号机显示叫号界面
- 管理员页面可以登录

**❌ 失败标志：**
- 页面显示 "无法访问此网站" 或 "连接被拒绝"
- 浏览器一直加载中
- 显示 404 或 500 错误

---

### 方法三：检查数据库文件

#### 步骤 1: 定位文件

数据库文件应该创建在 `queue-system.exe` **同目录下**：

```
dist/
├── queue-system.exe
└── database.sqlite    ← 这个文件应该存在
```

#### 步骤 2: 验证文件

**✅ 成功标志：**
- `database.sqlite` 文件存在
- 文件大小 > 0（通常几 KB 到几 MB）
- 文件创建时间与启动时间一致

**❌ 失败标志：**
- 文件不存在
- 文件大小为 0
- 出现权限错误

**检查方法：**

**Windows:**
```cmd
cd dist
dir database.sqlite
```

**PowerShell:**
```powershell
cd dist
Get-Item database.sqlite | Select-Object Name, Length, LastWriteTime
```

---

### 方法四：检查端口监听

#### Windows 方法

**使用 netstat 命令：**
```cmd
netstat -ano | findstr :3000
```

**✅ 成功标志：**
```
TCP    0.0.0.0:3000           0.0.0.0:0              LISTENING       xxxxx
```

**使用 PowerShell：**
```powershell
Get-NetTCPConnection -LocalPort 3000 -ErrorAction SilentlyContinue
```

**✅ 成功标志：**
```
LocalAddress    LocalPort State
------------    --------- -----
0.0.0.0         3000      Listen
```

#### Linux/macOS 方法

```bash
lsof -i :3000
# 或
netstat -tuln | grep 3000
```

**✅ 成功标志：**
```
COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
node    12345 user   23u  IPv4  ...   0t0  TCP *:3000 (LISTEN)
```

---

### 方法五：检查进程

#### Windows 方法

**使用任务管理器：**
1. 按 `Ctrl + Shift + Esc` 打开任务管理器
2. 切换到"详细信息"标签
3. 查找 `queue-system.exe` 进程

**✅ 成功标志：**
- 进程存在且正在运行
- CPU 使用率正常（通常 < 5%）
- 内存使用合理（通常 50-200MB）

**使用命令行：**
```cmd
tasklist | findstr queue-system
```

**✅ 成功标志：**
```
queue-system.exe          xxxxx Console             1     50,000 K
```

#### Linux/macOS 方法

```bash
ps aux | grep queue-system
```

---

## 📋 完整验证清单

按照以下清单逐一检查：

### 启动时检查

- [ ] 命令行窗口正常打开
- [ ] 看到 "数据库初始化成功" 消息
- [ ] 看到 "服务器运行在 http://0.0.0.0:3000" 消息
- [ ] 没有红色错误信息

### 文件检查

- [ ] `database.sqlite` 文件已创建
- [ ] 文件大小 > 0
- [ ] 文件权限正常

### 网络检查

- [ ] 端口 3000 正在监听
- [ ] 浏览器可以访问 http://localhost:3000
- [ ] 各个页面（ticket、display、counter、admin）都能正常打开

### 功能检查

- [ ] 取票页面可以选择业务类型
- [ ] 显示屏可以显示排队信息
- [ ] 叫号机界面正常
- [ ] 管理员可以登录

---

## 🔍 详细验证步骤

### 步骤 1: 启动程序

1. 进入 `dist` 目录
2. 双击 `queue-system.exe`
3. **不要关闭**弹出的命令行窗口

### 步骤 2: 观察命令行输出

等待 2-5 秒，观察命令行窗口的输出：

**正常输出示例：**
```
已从打包资源中复制初始数据库文件: /snapshot/... -> C:\...\database.sqlite
数据库初始化成功
定时任务状态: {
  "isRunning": true,
  "nextResetTime": "...",
  "resetTime": "00:00"
}
服务器运行在 http://0.0.0.0:3000
```

### 步骤 3: 测试浏览器访问

打开浏览器，依次访问：

1. **取票页面测试**
   ```
   http://localhost:3000/ticket
   ```
   - ✅ 应该看到业务类型选择界面
   - ✅ 可以选择业务类型并取号

2. **显示屏测试**
   ```
   http://localhost:3000/display
   ```
   - ✅ 应该看到排队显示界面
   - ✅ 可以显示当前叫号信息

3. **叫号机测试**
   ```
   http://localhost:3000/counter
   ```
   - ✅ 应该看到叫号机界面
   - ✅ 需要登录后才能使用

4. **管理员测试**
   ```
   http://localhost:3000/admin
   ```
   - ✅ 应该看到管理员登录界面或数据库管理界面

### 步骤 4: 检查文件系统

1. 在 `dist` 目录下检查：
   - `database.sqlite` 文件是否存在
   - 文件大小是否正常（通常 > 10KB）

2. 检查文件时间戳：
   - 文件创建时间应该与启动时间一致

### 步骤 5: 验证端口

打开新的命令行窗口，执行：

```cmd
netstat -ano | findstr :3000
```

应该看到类似输出：
```
TCP    0.0.0.0:3000           0.0.0.0:0              LISTENING      12345
```

---

## ⚠️ 常见问题诊断

### 问题 1: 命令行窗口立即关闭

**可能原因：**
- 程序启动失败
- 缺少依赖文件
- 数据库初始化错误

**解决方法：**
1. 在命令行中运行（不要双击）：
   ```cmd
   cd dist
   queue-system.exe
   ```
2. 查看完整错误信息
3. 检查是否有错误日志

### 问题 2: 端口被占用

**错误信息：**
```
Error: listen EADDRINUSE: address already in use :::3000
```

**解决方法：**

**方法一：** 修改端口
```cmd
set PORT=8080
queue-system.exe
```

**方法二：** 关闭占用端口的程序
```cmd
# 查找占用端口的进程
netstat -ano | findstr :3000

# 结束进程（替换 PID 为实际进程ID）
taskkill /PID <PID> /F
```

### 问题 3: 数据库文件创建失败

**错误信息：**
```
数据库初始化失败: ...
```

**可能原因：**
- 目录权限不足
- 磁盘空间不足
- 文件被其他程序占用

**解决方法：**
1. 检查目录权限
2. 检查磁盘空间
3. 确保没有其他程序占用数据库文件

### 问题 4: 浏览器无法访问

**可能原因：**
- 防火墙阻止
- 端口未正确监听
- 服务器未启动

**解决方法：**
1. 检查命令行窗口是否显示 "服务器运行在..."
2. 检查端口是否监听：`netstat -ano | findstr :3000`
3. 检查防火墙设置
4. 尝试使用 `127.0.0.1:3000` 代替 `localhost:3000`

---

## 🎯 快速验证脚本

创建一个批处理文件 `test.bat` 用于快速验证：

```batch
@echo off
echo ========================================
echo Queue System 验证脚本
echo ========================================
echo.

echo [1/4] 检查进程...
tasklist | findstr queue-system >nul
if %errorlevel% == 0 (
    echo ✓ 进程正在运行
) else (
    echo ✗ 进程未运行
)

echo.
echo [2/4] 检查端口...
netstat -ano | findstr :3000 >nul
if %errorlevel% == 0 (
    echo ✓ 端口 3000 正在监听
) else (
    echo ✗ 端口 3000 未监听
)

echo.
echo [3/4] 检查数据库文件...
if exist database.sqlite (
    echo ✓ 数据库文件存在
    for %%A in (database.sqlite) do echo   文件大小: %%~zA 字节
) else (
    echo ✗ 数据库文件不存在
)

echo.
echo [4/4] 测试 HTTP 连接...
curl -s http://localhost:3000 >nul
if %errorlevel% == 0 (
    echo ✓ HTTP 服务正常
) else (
    echo ✗ HTTP 服务无响应
)

echo.
echo ========================================
echo 验证完成！
echo ========================================
echo.
echo 如果所有项目都显示 ✓，说明程序运行正常
echo 请在浏览器中访问: http://localhost:3000
pause
```

将文件保存为 `test.bat`，放在 `dist` 目录下，双击运行即可快速验证。

---

## 📝 验证结果记录

建议记录验证结果，便于排查问题：

```
验证时间: ___________
验证人员: ___________

[ ] 命令行窗口正常打开
[ ] 看到 "数据库初始化成功"
[ ] 看到 "服务器运行在 http://0.0.0.0:3000"
[ ] database.sqlite 文件存在
[ ] 端口 3000 正在监听
[ ] 浏览器可以访问 http://localhost:3000
[ ] 取票页面正常
[ ] 显示屏正常
[ ] 叫号机正常
[ ] 管理员页面正常

问题记录:
_______________________________________
_______________________________________
```

---

## 💡 提示

1. **保持命令行窗口打开** - 关闭窗口会停止服务器
2. **首次启动较慢** - 数据库初始化可能需要几秒钟
3. **检查防火墙** - 如果无法访问，检查防火墙设置
4. **查看完整日志** - 命令行窗口会显示所有日志信息

---

## 🔗 相关文档

- [使用说明.txt](../dist/使用说明.txt) - 应用使用说明
- [数据库说明.txt](../dist/数据库说明.txt) - 数据库文件说明
- [打包步骤.md](./打包步骤.md) - 打包步骤说明

