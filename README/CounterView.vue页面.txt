## 2025.11.07
CounterView.vue é¡µé¢
â­1ã€å­—æ¯æŒ‰é”®æŸ¥è¯¢business_typesè¡¨ â­

â­2ã€ä¸šåŠ¡ç±»å‹åŒºåŸŸï¼Œå½“å‰ç­‰å¾…äººæ•°æ ¹æ®business_typesè¡¨çš„idï¼Œå…³è”æŸ¥è¯¢ticket_sequencesè¡¨ä¸­å„ä¸ªç±»å‹çš„å½“å‰ç­‰å¾…äººæ•°ï¼Œ
è®¡ç®—æ–¹å¼æ˜¯current_total_numberå­—æ®µå€¼ å‡å» current_passed_numberå­—æ®µå€¼ å¾—åˆ°çš„å€¼ï¼›

â­å„ä¸ªä¸šåŠ¡çš„ä¸Šä¸€ä¸ªæœåŠ¡å·ç last-service-numberï¼Œæ ¹æ®ä¸šåŠ¡idå’Œå½“å‰æŸœå°idå…³è”æŸ¥è¯¢counter_business_last_ticketè¡¨ï¼Œæ˜¾ç¤ºlast_ticket_noå­—æ®µå€¼

â­3ã€æ ¹æ®å½“å‰IPåœ°å€ï¼ŒæŸ¥è¯¢countersè¡¨ï¼Œè·å–å½“å‰æŸœå°å· â­

-----------------------------------------------------

â­4ã€ç‚¹å‡»nextæŒ‰é’®ï¼Œticket_sequencesè¡¨å¯¹åº”çš„ä¸šåŠ¡é˜Ÿåˆ—current_passed_numberå­—æ®µå€¼è‡ªå¢1ï¼Œ
å¹¶ä¿®æ”¹countersè¡¨çš„current_ticket_numberå­—æ®µå€¼ï¼ˆä¸šåŠ¡code+ä¸‰ä½çš„current_passed_numberå€¼ï¼‰
ç¨åå®ç°ä¼ é€’ä¿¡å·è¿›è¡Œè¯­éŸ³æ’­æŠ¥
ã€ CounterView.vueé¡µé¢ï¼Œç‚¹å‡»nextæŒ‰é’®ï¼Œè¦å®ç°å¦‚ä¸‹ï¼š
  1ã€ticket_sequencesè¡¨å¯¹åº”çš„ä¸šåŠ¡é˜Ÿåˆ—current_passed_numberå­—æ®µå€¼è‡ªå¢1ï¼Œ
  2ã€åŒæ—¶ä¿®æ”¹countersè¡¨çš„current_ticket_numberå­—æ®µå€¼ï¼ˆä¸ºä¸šåŠ¡code+ä¸‰ä½çš„current_passed_numberå€¼ï¼‰ã€‚
  3ã€æ ¹æ®ä¸šåŠ¡idå’ŒæŸœå°idï¼Œä¿®æ”¹counter_business_last_ticketè¡¨å¯¹åº”è®°å½•çš„last_ticket_noå­—æ®µå€¼ï¼ˆä¸ºä¸šåŠ¡code+ä¸‰ä½çš„current_passed_numberå€¼ï¼‰ã€‚
  4ã€ä¹‹åç«‹é©¬åˆ·æ–°é¡µé¢ï¼Œå®ç°å„ä¸šåŠ¡ç­‰å¾…äººæ•°ï¼Œå’Œå½“å‰æŸœå°å½“å‰æœåŠ¡å·çš„æ›´æ–°
ã€‘
æ·»åŠ  ticket:nextCalled äº‹ä»¶ç›‘å¬å™¨
æ”¶åˆ°äº‹ä»¶åç«‹å³åˆ·æ–°ï¼š
fetchWaitingCounts() - åˆ·æ–°ç­‰å¾…äººæ•°
fetchCurrentTicketNumber() - åˆ·æ–°å½“å‰ç¥¨å·
fetchLastServiceNumbers() - åˆ·æ–°ä¸Šä¸€ä¸ªæœåŠ¡å·

-----------------------------------------------------

5ã€ç‚¹å‡»recallï¼Œä¼ é€’ä¿¡å·è¿›è¡Œè¯­éŸ³æ’­æŠ¥ ğŸŒ™

6ã€æ‰‹åŠ¨è¾“å…¥æœåŠ¡å·ä¹‹åï¼Œç‚¹å‡»startæŒ‰é’®ï¼Œä¼ é€’ä¿¡å·è¿›è¡Œè¯­éŸ³æ’­æŠ¥ ğŸŒ™

â­7ã€ç‚¹å‡»endä¹‹åï¼Œæ‰èƒ½ç‚¹å‡»nextè¿›è¡Œä¸‹ä¸€ä¸ªï¼ˆå³ç‚¹å‡»äº†startä¹‹åï¼Œå¿…é¡»è¦ç‚¹å‡»ä¸€æ¬¡endæ‰å¯ä»¥ç‚¹å‡»nextï¼‰

â­8ã€è¾“å…¥æ˜¾ç¤ºåŒºåŸŸï¼Œæ˜¾ç¤ºcountersè¡¨çš„current_ticket_numberå­—æ®µå€¼ â­
ã€CounterView.vueé¡µé¢ï¼Œè¾“å…¥æ˜¾ç¤ºåŒºåŸŸï¼Œæ ¹æ®å½“å‰ipå€¼æˆ–counter_numberï¼Œè°ƒç”¨åç«¯APIæŸ¥è¯¢å¹¶æ˜¾ç¤ºcountersè¡¨çš„current_ticket_numberå­—æ®µå€¼ã€‘

â­9ã€é€šè¿‡IPåœ°å€å¦‚æœæ²¡æœ‰æŸ¥è¯¢åˆ°counterï¼Œåˆ™counterViewé¡µé¢ç›´æ¥æ˜¾ç¤ºâ€œè®¾å¤‡ä¸æ”¯æŒâ€

10ã€tickerå–ç¥¨é¡µé¢ï¼Œä¹Ÿè¦å®ç°å–ç¥¨ä¹‹åï¼Œå®ç° WebSocket å¹¿æ’­åŠŸèƒ½ã€‚å½“ç‚¹å‡» å–ç¥¨ æŒ‰é’®åï¼Œæ‰€æœ‰æŸœå°é¡µé¢ä¼šç«‹å³åˆ·æ–°ã€‚

â­11ã€å½“æ‰‹åŠ¨ç‚¹å‡»æ•°å­—æŒ‰é’®è¾“å…¥ä¹‹åï¼Œæ‰å¯ä»¥ç‚¹å‡»startæŒ‰é’®ï¼Œç‚¹å‡»startæŒ‰é’®ä¹‹åï¼Œåœ¨ç‚¹å‡»endæŒ‰é’®ä¹‹å‰ï¼Œä¸èƒ½å¤Ÿç‚¹å‡»nextå’Œrecallã€‚
ç»™å‡ºå¼¹çª—æç¤ºï¼Œä½¿ç”¨ç¹ä½“ä¸­æ–‡å’Œè‹±æ–‡æç¤º

-----------------------------------------------------

â­12ã€å®šæ—¶ä»»åŠ¡ï¼šè¯»å– settings è¡¨çš„ key å€¼ä¸º ticket_reset_time çš„ value å€¼ï¼Œæ¯æ—¥çš„è¿™ä¸ªæ—¶é—´ï¼Œ
  a.è‡ªåŠ¨å°† ticket_sequences è¡¨çš„æ‰€æœ‰è®°å½•çš„ current_total_number å’Œ current_passed_number å­—æ®µå€¼é‡ç½®ä¸º0ï¼Œ
    dateå­—æ®µè®¾ç½®ä¸ºå½“å‰æ—¥æœŸï¼ˆæ¯”å¦‚2025-11-11ï¼‰
  b.è‡ªåŠ¨å°† counter_business_last_ticket è¡¨çš„æ‰€æœ‰è®°å½•çš„last_ticket_noå­—æ®µå€¼æ¸…ç©º
  c.è‡ªåŠ¨å°† counters è¡¨çš„æ‰€æœ‰è®°å½•çš„ current_ticket_number å­—æ®µå€¼æ¸…ç©º

  æ¯æ—¥é‡ç½®ä»»åŠ¡ç°åœ¨ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
  é‡ç½® ticket_sequences è¡¨ï¼š
    Â·å°†æ‰€æœ‰è®°å½•çš„ current_total_number é‡ç½®ä¸º 0
    Â·å°†æ‰€æœ‰è®°å½•çš„ current_passed_number é‡ç½®ä¸º 0
    Â·å°†æ‰€æœ‰è®°å½•çš„ date å­—æ®µè®¾ç½®ä¸ºå½“å‰æ—¥æœŸ
  æ¸…ç©º counters è¡¨ï¼š
    Â·å°†æ‰€æœ‰è®°å½•çš„ current_ticket_number å­—æ®µæ¸…ç©º
  æ¸…ç©º counter_business_last_ticket è¡¨ï¼š
    Â·å°†æ‰€æœ‰è®°å½•çš„ last_ticket_no å­—æ®µæ¸…ç©º

-----------------------------------------------------

â­13ã€http://localhost:5173/admin/settingsé¡µé¢æ›´æ–°settingsï¼Œä¼šé‡æ–°å¯åŠ¨é‡ç½®ä»»åŠ¡å—ï¼ˆå¥½åƒä¼š

14ã€toostæç¤ºä¹‹åï¼Œæ‰ä¼šæ›´æ–°é¡µé¢ï¼ˆå†çœ‹çœ‹

â­15ã€CounterView.vueé¡µé¢ï¼Œå½“ç­‰å¾…äººæ•°ä¸º0æ—¶ï¼Œç‚¹å‡»nextå’ŒrecallæŒ‰é’®ï¼Œ
    å¼¹å‡ºæç¤ºâ€œè¯¥æœåŠ¡å½“å‰æ— ç­‰å¾…äººæ•°â€ï¼ˆç¹ä½“+è‹±æ–‡ï¼‰ï¼Œå¹¶ä¸”ä¸è°ƒç”¨åç«¯APIå¤„ç†å«å·

â­16ã€CounterView.vueé¡µé¢ï¼Œå½“ä¸å­˜åœ¨ä¸Šä¸€ä¸ªæœåŠ¡å·ï¼Œè€Œæ˜¾ç¤ºA000ï¼ˆcode + '000'ï¼‰æ—¶ï¼Œå­—ä½“ç”¨ç°è‰²æ˜¾ç¤º

â­17ã€ä½†ç‚¹å‡»nextå¹¶æˆåŠŸè°ƒç”¨åç«¯APIå¤„ç†å«å·æ—¶ï¼Œé™¤äº†è¦é€šçŸ¥æ‰€æœ‰CounterView.vueé¡µé¢åˆ·æ–°æ•°æ®æ˜¾ç¤ºï¼Œè¿˜éœ€è¦é€šçŸ¥DisplayView.vueé¡µé¢åˆ·æ–°æ•°æ®æ˜¾ç¤º

----------------------------------------------------------------------

ç°åœ¨æˆ‘è¦å®ç°è¯­éŸ³æ’­æ”¾
åœ¨@CounterView.vue é¡µé¢ç‚¹å‡»nextã€recallã€startæŒ‰é’®æ—¶ ï¼Œä¼ é€’æ¶ˆæ¯ï¼Œ@DisplayView.vue é¡µé¢æ¥å—æ¶ˆæ¯è¿›è¡Œè¯­éŸ³æ’­æ”¾ï¼Œé€šå¸¸åªæœ‰åº”è¯¥displayè®¾å¤‡ï¼Œå°±æ˜¯settingsè¡¨ä¸­keyå€¼ä¸ºdisplay_server_ipçš„IPåœ°å€ã€‚counteré¡µé¢éœ€è¦ä¼ é€’input-displayå’Œcounter-numberä¿¡æ¯ï¼Œè¯­éŸ³æ’­æ”¾å†…å®¹ä¸¾ä¾‹ï¼šè¯·A001å·åˆ°2å·æŸœå°åŠç†ä¸šåŠ¡ã€‚
è¿˜éœ€è¦æ³¨æ„ï¼Œä¼šåŒæ—¶æœ‰å¾ˆå¤šå°è®¾å¤‡è®¿é—®@CounterView.vue é¡µé¢ï¼Œé‚£ä¹ˆè¯­éŸ³æ’­æŠ¥æŒ‡ä»¤ä¹Ÿä¼šåŒæ—¶å‘å‡ºï¼Œéœ€è¦æ’é˜Ÿä¸€ä¸ªä¸€ä¸ªæ’­æ”¾ï¼ˆæ³¨æ„æ€§èƒ½ä¼˜åŒ–ï¼Œä¸è¦å¡æœº